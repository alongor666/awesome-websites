<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self'
            https://unpkg.com
            https://cdn.tailwindcss.com
            https://cdn.jsdelivr.net
            https://cdnjs.cloudflare.com;
        style-src 'self' 'unsafe-inline'
            https://cdn.tailwindcss.com
            https://cdnjs.cloudflare.com;
        img-src 'self' data: https: http:;
        font-src 'self' https://cdnjs.cloudflare.com;
        connect-src 'self' https://generativelanguage.googleapis.com
            https://www.google.com;
        frame-src 'self' https://discord.com https://colab.research.google.com;
        base-uri 'self';
        form-action 'self';
        object-src 'none';
        require-trusted-types-for 'script';
    ">
    <title>é˜¿é¾™çš„æ•°å­—åŒ–ä½œæˆ˜ä¸­å¿ƒ | Ah Long's OS v5.3</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js" integrity="sha384-dsKF6mTFbcNJ43SlwL16S4PsymmtsPsOYBYCgIpFYXWGpuxleajsS7EusvgAc5/V" crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha384-iw3OoTErCYJJB9mCa8LNS2hbsQ7M3C0EpIsO/H5+EGAkPGc6rk+V8i04oW/K5xq0" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" integrity="sha384-948ahk4ZmxYVYOc+rxN1H2gM1EJ2Duhp7uHtZ4WSLkV4Vtx5MUqnV+l7u9B+jFv+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js" integrity="sha384-vdScihEZCfbPnBQf+lc7LgXUdJVYyhC3yWHUW5C5P5GpHRqVnaM6HJELJxT6IqwM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.js" integrity="sha384-57VRFGvLpSky5EqUImBJSOkJI+6xYMONZqn8Zh70E+1DyMPpN1vQkaJaN4YqRmln" crossorigin="anonymous"></script>
    
    <style>
        :root {
            /* macOS é¢œè‰²ç³»ç»Ÿ */
            --macos-bg: #f5f5f7;
            --macos-sidebar-bg: rgba(255, 255, 255, 0.8);
            --macos-card-bg: rgba(255, 255, 255, 0.9);
            --macos-text-primary: #1d1d1f;
            --macos-text-secondary: #6e6e73;
            --macos-accent: #007aff;
            --macos-hover: rgba(0, 122, 255, 0.1);
            --macos-border: rgba(0, 0, 0, 0.1);
            --macos-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            --macos-blur: blur(20px);

            /* çª—å£æ§åˆ¶æŒ‰é’® */
            --macos-red: #ff5f57;
            --macos-yellow: #ffbd2e;
            --macos-green: #28ca42;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(180deg, #f5f5f7 0%, #e8e8ed 100%);
            color: var(--macos-text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 14px;
            line-height: 1.5;
        }

        /* macOS ä¾§è¾¹æ  */
        .sidebar {
            background: var(--macos-sidebar-bg);
            backdrop-filter: var(--macos-blur);
            -webkit-backdrop-filter: var(--macos-blur);
            border-right: 1px solid var(--macos-border);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.05);
        }

        .group-header {
            font-size: 11px;
            font-weight: 600;
            color: var(--macos-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 20px 20px 8px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .group-header i {
            font-size: 10px;
            opacity: 0.5;
        }

        /* macOS å¡ç‰‡è®¾è®¡ */
        .site-card {
            background: var(--macos-card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--macos-border);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .site-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--macos-shadow);
            border-color: rgba(0, 122, 255, 0.2);
            background: rgba(255, 255, 255, 0.95);
        }

        /* macOS å½©è‰²æŒ‡ç¤ºæ¡ */
        .color-bar {
            height: 4px;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        /* macOS æ ‡ç­¾ */
        .badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 500;
            display: inline-block;
            line-height: 1.2;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .badge-core {
            background: rgba(0, 122, 255, 0.1);
            color: var(--macos-accent);
            border: 1px solid rgba(0, 122, 255, 0.2);
        }
        .badge-doc {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
            border: 1px solid rgba(52, 199, 89, 0.2);
        }
        .badge-vpn {
            background: rgba(175, 82, 222, 0.1);
            color: #af52de;
            border: 1px solid rgba(175, 82, 222, 0.2);
        }

        /* macOS æ»šåŠ¨æ¡ */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background-color: rgba(0, 0, 0, 0.3);
            background-clip: content-box;
        }

        /* macOS å¯¼èˆªé¡¹ */
        .nav-item {
            padding: 8px 20px;
            margin: 2px 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .nav-item-active {
            background: var(--macos-hover);
            color: var(--macos-accent);
            font-weight: 600;
        }

        .nav-item:hover:not(.nav-item-active) {
            background: rgba(0, 0, 0, 0.05);
        }

        /* çª—å£æ§åˆ¶æŒ‰é’® */
        .window-controls {
            display: flex;
            gap: 8px;
            padding: 12px 20px;
        }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .window-control:hover {
            opacity: 0.8;
        }

        .window-control.close {
            background: var(--macos-red);
        }

        .window-control.minimize {
            background: var(--macos-yellow);
        }

        .window-control.maximize {
            background: var(--macos-green);
        }

        /* macOS æœç´¢æ¡† */
        .macos-search {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--macos-border);
            border-radius: 8px;
            padding: 8px 16px;
            transition: all 0.3s ease;
        }

        .macos-search:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--macos-accent);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* macOS æŒ‰é’®æ ·å¼ */
        .macos-btn {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--macos-border);
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .macos-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }

        .macos-btn-primary {
            background: var(--macos-accent);
            color: white;
            border-color: var(--macos-accent);
        }

        .macos-btn-primary:hover {
            background: #0051d5;
            border-color: #0051d5;
        }
        
        /* macOS åŠ¨ç”»æ•ˆæœ */
        .modal-enter-active {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .modal-leave-active {
            transition: all 0.2s cubic-bezier(0.55, 0.055, 0.675, 0.19);
        }
        .modal-enter-from {
            opacity: 0;
            transform: scale(0.9) translateY(-20px);
        }
        .modal-leave-to {
            opacity: 0;
            transform: scale(0.95) translateY(-10px);
        }

        /* å¼¹æ€§åŠ¨ç”» */
        @keyframes bounce-in {
            0% { transform: scale(0.95); opacity: 0; }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); opacity: 1; }
        }

        .bounce-in {
            animation: bounce-in 0.4s ease-out;
        }

        /* å¡ç‰‡å…¥åœºåŠ¨ç”» */
        .site-card {
            animation: slide-up 0.5s ease-out;
        }

        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ä¾§è¾¹æ è¿‡æ¸¡ */
        .sidebar-enter-active,
        .sidebar-leave-active {
            transition: transform 0.3s ease;
        }

        .sidebar-enter-from {
            transform: translateX(-100%);
        }

        .sidebar-leave-to {
            transform: translateX(-100%);
        }

        /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .macos-btn:active {
            transform: scale(0.98);
        }

        /* æœç´¢èšç„¦åŠ¨ç”» */
        .macos-search:focus {
            transform: scale(1.02);
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden text-sm">

<div id="app" class="flex w-full h-full">

    <!-- macOS é£æ ¼ä¾§è¾¹æ  -->
    <aside class="sidebar w-64 flex-shrink-0 flex flex-col h-full z-20">
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <div class="flex items-center justify-between border-b border-gray-200/50">
            <div class="window-controls">
                <div class="window-control close" title="å…³é—­"></div>
                <div class="window-control minimize" title="æœ€å°åŒ–"></div>
                <div class="window-control maximize" title="æœ€å¤§åŒ–"></div>
            </div>
        </div>

        <div class="p-6 pb-4">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                    <i class="fa-solid fa-compass-drafting"></i>
                </div>
                <div>
                    <h1 class="font-semibold text-base text-gray-900">ä½œæˆ˜ä¸­å¿ƒ</h1>
                    <p class="text-xs text-gray-500">v5.3 Professional</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 mb-4">
                <button @click="openAddModal" class="macos-btn flex items-center justify-center gap-1.5 text-xs">
                    <i class="fa-solid fa-plus"></i>
                    <span>å½•å…¥</span>
                </button>
                <button @click="openAnalysisModal" class="macos-btn macos-btn-primary flex items-center justify-center gap-1.5 text-xs">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>ç›˜ç‚¹</span>
                </button>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto custom-scroll pb-6">
            <div class="nav-item" :class="currentFilter==='all' ? 'nav-item-active' : ''" @click="currentFilter='all'">
                <i class="fa-solid fa-border-all w-4 opacity-60"></i>
                <span class="ml-3">å…¨å±€å…¨é‡</span>
                <span class="ml-auto text-xs opacity-60">{{ allSites.length }}</span>
            </div>

            <template v-for="(group, gIndex) in groupedCategories" :key="gIndex">
                <div class="group-header">
                    <i :class="group.icon"></i>
                    {{ group.groupName }}
                </div>
                <div v-for="cat in group.items" :key="cat.id"
                     class="nav-item text-xs"
                     :class="currentFilter===cat.id ? 'nav-item-active' : ''"
                     @click="currentFilter=cat.id">
                    <span class="flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full opacity-60" :style="{background: cat.color}"></span>
                        {{ cat.name }}
                    </span>
                    <span class="ml-auto text-xs opacity-50">{{ getCountByCategory(cat.id) }}</span>
                </div>
            </template>
        </nav>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <div class="p-4 border-t border-gray-200/50 flex justify-between items-center">
            <span class="text-xs text-gray-500">
                <i class="fa-solid fa-database mr-1"></i> Data v5.3
            </span>
            <button @click="openSettings" class="text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fa-solid fa-gear"></i>
            </button>
        </div>
    </aside>

    <!-- macOS é£æ ¼ä¸»å†…å®¹åŒº -->
    <main class="flex-1 h-full flex flex-col overflow-hidden relative">
        <!-- macOS æ ‡é¢˜æ  -->
        <header class="h-16 flex items-center justify-between px-8 bg-white/60 backdrop-blur-xl border-b border-gray-200/50 sticky top-0 z-10">
            <div class="flex items-center gap-6 flex-1">
                <h2 class="text-base font-semibold text-gray-900">{{ getCurrentPageTitle }}</h2>
                <div class="h-6 w-px bg-gray-300"></div>
                <!-- Spotlight é£æ ¼æœç´¢æ¡† -->
                <div class="relative w-full max-w-md">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
                    </div>
                    <input
                        type="text"
                        v-model="searchQuery"
                        placeholder="æœç´¢ (âŒ˜K)"
                        class="macos-search w-full pl-10 pr-4 text-sm"
                        @keydown.cmd.k.prevent="searchQuery = ''; $el.focus()"
                    >
                </div>
            </div>
            <div class="flex items-center gap-4">
                <!-- æ—¶é—´æ˜¾ç¤º -->
                <div class="text-sm text-gray-600 font-medium">
                    {{ currentTime }}
                </div>
            </div>
        </header>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="flex-1 overflow-y-auto p-8 custom-scroll">
            <!-- ç©ºçŠ¶æ€ -->
            <div v-if="displaySites.length === 0" class="flex flex-col items-center justify-center h-full">
                <div class="w-20 h-20 bg-gray-100 rounded-2xl flex items-center justify-center mb-4">
                    <i class="fa-solid fa-inbox text-3xl text-gray-400"></i>
                </div>
                <p class="text-gray-500">æš‚æ— ç›¸å…³èµ„äº§</p>
            </div>

            <div v-else>
                <!-- å…¨å±€è§†å›¾ï¼šæŒ‰ä¸šåŠ¡æ¿å—åˆ†ç»„ -->
                <div v-if="currentFilter === 'all'">
                    <div v-for="(groupData, groupName) in displaySitesGrouped" :key="groupName" class="mb-10">
                        <div class="flex items-center gap-3 mb-4">
                            <h3 class="text-sm font-bold text-slate-700">{{ groupName }}</h3>
                            <div class="h-px flex-1 bg-slate-200"></div>
                            <span class="text-[10px] font-mono text-slate-400">{{ groupData.length }}</span>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">
                            <div v-for="site in groupData" :key="site.url" class="site-card group h-24 p-3.5 flex flex-col justify-between cursor-pointer" @click="visitSite(site)">
                                <div class="color-bar" :style="{background: getCategoryColor(site.category)}"></div>
                                <div class="flex items-start gap-3 mt-1">
                                    <img :src="getFavicon(site.url)" @error="handleImageError" class="w-8 h-8 rounded-lg bg-white border border-slate-100 p-0.5 object-contain flex-shrink-0">
                                    <div class="min-w-0 flex-1">
                                        <h4 class="font-bold text-slate-800 text-xs truncate leading-snug group-hover:text-blue-600 transition-colors" :title="site.name">{{ site.name }}</h4>
                                        <p class="text-[10px] text-slate-400 truncate mt-0.5 opacity-80">{{ getDomain(site.url) }}</p>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between mt-2">
                                    <div class="flex gap-1">
                                        <span v-if="site.rank <= 3" class="badge badge-core">Top</span>
                                        <span v-if="site.tags && site.tags.includes('doc')" class="badge badge-doc">Doc</span>
                                        <span v-if="site.tags && site.tags.includes('vpn')" class="badge badge-vpn">Net</span>
                                    </div>
                                    <button @click.stop="deleteSite(site)" class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-opacity p-1"><i class="fa-solid fa-trash text-[10px]"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸“æ³¨æ¨¡å¼ -->
                <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">
                    <div v-for="site in displaySites" :key="site.url" class="site-card group h-24 p-3.5 flex flex-col justify-between cursor-pointer" @click="visitSite(site)">
                        <div class="color-bar" :style="{background: getCategoryColor(site.category)}"></div>
                        <div class="flex items-start gap-3 mt-1">
                            <img :src="getFavicon(site.url)" @error="handleImageError" class="w-8 h-8 rounded-lg bg-white border border-slate-100 p-0.5 object-contain flex-shrink-0">
                            <div class="min-w-0 flex-1">
                                <h4 class="font-bold text-slate-800 text-xs truncate leading-snug group-hover:text-blue-600" :title="site.name">{{ site.name }}</h4>
                                <p class="text-[10px] text-slate-400 truncate mt-0.5 opacity-80">{{ getDomain(site.url) }}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between mt-2">
                            <div class="flex gap-1">
                                <span v-if="site.rank <= 3" class="badge badge-core">Top</span>
                                <span v-if="site.tags && site.tags.includes('doc')" class="badge badge-doc">Doc</span>
                                <span v-if="site.tags && site.tags.includes('vpn')" class="badge badge-vpn">Net</span>
                            </div>
                            <button @click.stop="deleteSite(site)" class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-opacity p-1"><i class="fa-solid fa-trash text-[10px]"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- macOS é£æ ¼æ¨¡æ€æ¡† -->
    <transition name="modal">
        <div v-if="showModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
            <div class="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-md p-6 border border-gray-200/50" @click.stop>
                <div class="flex justify-between items-center mb-5">
                    <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wider">æ–°å¢æ•°å­—èµ„äº§</h3>
                    <button @click="closeModal" class="text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <!-- AI Smart Add -->
                <div class="mb-5 bg-indigo-50 p-3 rounded-lg border border-indigo-100/50">
                    <div class="flex gap-2">
                        <input v-model="smartInput" @keyup.enter="smartParse" type="text" class="flex-1 bg-transparent text-xs outline-none text-indigo-900 placeholder-indigo-300" placeholder="ç²˜è´´ä»»æ„æ–‡æœ¬ï¼ŒAI è‡ªåŠ¨å½’ç±»...">
                        <button @click="smartParse" :disabled="isProcessing" class="text-indigo-600 hover:text-indigo-800 text-xs font-bold disabled:opacity-50">
                            <i v-if="isProcessing" class="fa-solid fa-circle-notch fa-spin"></i> <span v-else>è¯†åˆ«</span>
                        </button>
                    </div>
                </div>
                <div class="space-y-4">
                    <input v-model="newSite.name" class="w-full p-3 bg-gray-50/50 border border-gray-200 rounded-xl text-sm focus:border-blue-500 focus:bg-white outline-none transition-all" placeholder="èµ„äº§åç§°">
                    <input v-model="newSite.url" class="w-full p-3 bg-gray-50/50 border border-gray-200 rounded-xl text-sm focus:border-blue-500 focus:bg-white outline-none transition-all" placeholder="URL åœ°å€">
                    <select v-model="newSite.category" class="w-full p-3 bg-gray-50/50 border border-gray-200 rounded-xl text-sm focus:border-blue-500 outline-none">
                        <option v-for="cat in flatCategories" :value="cat.id">{{ cat.name }}</option>
                    </select>
                </div>
                <div class="flex gap-3 mt-6">
                    <button @click="closeModal" class="macos-btn flex-1 py-2.5 text-sm">å–æ¶ˆ</button>
                    <button @click="addSite" class="macos-btn macos-btn-primary flex-1 py-2.5 text-sm">ç¡®è®¤æ·»åŠ </button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="modal">
        <div v-if="showAnalysisModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
            <div class="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-4xl h-[75vh] flex flex-col p-8 border border-gray-200/50" @click.stop>
                <div class="flex justify-between items-center mb-4 border-b pb-3">
                    <h3 class="text-sm font-bold text-slate-800"><i class="fa-solid fa-wand-magic-sparkles text-purple-600 mr-2"></i>èµ„äº§ç»“æ„åˆ†æ</h3>
                    <button @click="closeAnalysisModal" class="text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="flex-1 overflow-y-auto custom-scroll prose prose-sm max-w-none p-2 text-slate-600">
                    <div v-if="!analysisResult && !isAnalyzing" class="text-center mt-20 text-slate-400">
                        <i class="fa-solid fa-brain text-5xl mb-4 text-purple-200"></i>
                        <p>AI å°†åŸºäº MECE åŸåˆ™åˆ†ææ‚¨çš„å·¥å…·æ ˆè¦†ç›–åº¦ä¸ç¼ºå¤±ã€‚</p>
                    </div>
                    <div v-if="isAnalyzing" class="flex flex-col items-center justify-center mt-20 text-purple-600">
                        <i class="fa-solid fa-circle-notch fa-spin text-2xl mb-3"></i>
                        <p class="text-xs">Deep Thinking...</p>
                    </div>
                    <div v-if="analysisResult" v-html="safeRenderMarkdown(analysisResult)"></div>
                </div>
                <div class="mt-4 pt-3 border-t flex justify-end">
                    <button @click="analyzeAssets" :disabled="isAnalyzing" class="px-5 py-2 bg-purple-600 text-white rounded-lg text-xs font-bold hover:bg-purple-700 shadow-lg shadow-purple-200">å¼€å§‹åˆ†æ</button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="modal">
        <div v-if="showSettingsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
            <div class="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-md p-6 border border-gray-200/50" @click.stop>
                <h3 class="text-base font-semibold text-gray-900 mb-5">API é…ç½®</h3>
                <input v-model="tempApiKey" type="password" class="w-full p-3 bg-gray-50/50 border border-gray-200 rounded-xl text-sm focus:border-blue-500 outline-none font-mono" placeholder="sk-...">
                <div class="flex justify-end gap-3 mt-6">
                    <button @click="showSettingsModal = false" class="macos-btn px-5 py-2 text-sm">å–æ¶ˆ</button>
                    <button @click="saveSettings" class="macos-btn macos-btn-primary px-5 py-2 text-sm">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </transition>

</div>

<script>
const { createApp, ref, computed, onMounted } = Vue;

// ----------------------------------------------------------------
// MECE åˆ†ç±»ä½“ç³» v5.3 (ä¸“ä¸š/é€šç”¨è§„åˆ™ä¼˜åŒ–)
// ----------------------------------------------------------------
const CATEGORY_STRUCTURE = [
    {
        groupName: "ğŸ›ï¸ ç»è¥å†³ç­– (Executive)",
        icon: "fa-solid fa-briefcase",
        items: [
            { id: "biz_ops", name: "å†…éƒ¨ååŒ & ç³»ç»Ÿ", color: "#2563eb" }, 
            { id: "biz_data", name: "BI æŠ¥è¡¨ & ç›‘æ§", color: "#dc2626" },
            { id: "biz_ext", name: "ç›‘ç®¡ & å¸‚åœºæƒ…æŠ¥", color: "#b91c1c" }
        ]
    },
    {
        groupName: "ğŸ§  æ™ºèƒ½ä½“ (AI Matrix)",
        icon: "fa-solid fa-brain",
        items: [
            { id: "ai_chat", name: "å‰æ²¿ SOTA æ¨¡å‹", color: "#8b5cf6" },
            { id: "ai_cn", name: "å›½äº§å¤§æ¨¡å‹", color: "#7c3aed" },
            { id: "ai_search", name: "Deep Search & Agent", color: "#6d28d9" }
        ]
    },
    {
        groupName: "âš™ï¸ å¼€å‘è€… (Dev Studio)",
        icon: "fa-solid fa-code",
        items: [
            { id: "dev_ide", name: "äº‘ç«¯ IDE & è¾…åŠ©", color: "#10b981" },
            { id: "dev_api", name: "æ¨¡å‹ API ç®¡ç†", color: "#059669" },
            { id: "dev_infra", name: "å…¨æ ˆäº‘åŸºå»º", color: "#047857" },
            { id: "dev_mcp", name: "MCP ç”Ÿæ€åè®®", color: "#065f46" }
        ]
    },
    {
        groupName: "ğŸ¨ åˆ›æ„æµ (Creative)",
        icon: "fa-solid fa-palette",
        items: [
            { id: "create_vision", name: "è§†è§‰ & è§†é¢‘æµ", color: "#f59e0b" },
            { id: "create_design", name: "äº¤äº’ & å¯è§†åŒ–", color: "#d97706" }
        ]
    },
    {
        groupName: "ğŸ“š çŸ¥è¯†ä½“ç³» (Knowledge)",
        icon: "fa-solid fa-graduation-cap",
        items: [
            { id: "know_research", name: "å­¦æœ¯ç§‘ç ” (Research)", color: "#0f172a" },
            { id: "know_mgmt", name: "ç¬¬äºŒå¤§è„‘ (Notes)", color: "#334155" },
            { id: "know_learn", name: "ç»ˆèº«å­¦ä¹  (Edu)", color: "#475569" },
            { id: "know_ref", name: "å‚è€ƒèµ„æ–™ (Ref)", color: "#64748b" }
        ]
    },
    {
        groupName: "ğŸ› ï¸ æ•ˆèƒ½åŸºå»º (Infrastructure)",
        icon: "fa-solid fa-screwdriver-wrench",
        items: [
            { id: "tool_collab", name: "ååŒé€šè®¯ (Collab)", color: "#2563eb" },
            { id: "tool_office", name: "åŠå…¬ä¸æ•°æ® (Office)", color: "#0ea5e9" },
            { id: "tool_net", name: "ç½‘ç»œä¸è´¦æˆ· (Net)", color: "#6366f1" },
            { id: "my_works", name: "ä¸ªäººå‘å¸ƒ (Deploy)", color: "#ec4899" }
        ]
    }
];

// ----------------------------------------------------------------
// å…¨é‡æ•°æ® + åœºæ™¯åŒ–æƒé‡ (Rank: 1=Highest)
// ----------------------------------------------------------------
const PARSED_DATA = [
    // --- 1.1 å†…éƒ¨ååŒ (biz_ops) ---
    { name: "ä¼å¾®æ–‡æ¡£", url: "https://doc.weixin.qq.com/home/recent", category: "biz_ops", rank: 1, tags: ["doc"] },
    { name: "é‚®ä»¶ç³»ç»Ÿ", url: "https://webmail.sinosafe.com.cn/coremail/XT/index.jsp", category: "biz_ops", rank: 2 },
    { name: "OneDrive", url: "https://onedrive.live.com/", category: "biz_ops", rank: 3, tags: ["doc"] },
    { name: "OA åŠå…¬ç³»ç»Ÿ", url: "http://oa.sinosafe.com.cn/login.jsp", category: "biz_ops", rank: 4 },
    { name: "è½¦é™©æ ¸å¿ƒ", url: "http://auto.sinosafe.com.cn/index.jsp", category: "biz_ops", rank: 5 },
    { name: "ç”µé”€ CRM", url: "https://crm.sinosafe.com.cn/", category: "biz_ops", rank: 6 },
    { name: "åæ´—é’±å·¥ä½œå°", url: "http://amlnew.sinosafe.com.cn/#/work-support/report-work/report-check", category: "biz_ops", rank: 7 },
    { name: "ä¼å¤§åŸ¹è®­å¹³å°", url: "http://nclm.qida.com/#taskInput?id=200073745", category: "biz_ops", rank: 8 },
    { name: "åˆ é‚®ä»¶å…¥å£", url: "https://webmail.sinosafe.com.cn/coremail/XT/index.jsp?sid=CAdLwXbbpKJeMFSEXHIsOLJvgmytvowb#mail.list|%7B%22fid%22%3A1%7D", category: "biz_ops", rank: 9 },

    // --- 1.2 æ•°æ®å†³ç­– (biz_data) ---
    { name: "ç»è¥å†³ç­–ç³»ç»Ÿ", url: "http://iap.sinosafe.com.cn/#/analysisdor/analysis/countAnalysis", category: "biz_data", rank: 1 },
    { name: "FineBI æŠ¥è¡¨å¹³å°", url: "http://bi.sinosafe.com.cn/", category: "biz_data", rank: 2 },
    { name: "ç»­ä¿ç›‘æ§", url: "http://bi.sinosafe.com.cn/decision/link/rVYp", category: "biz_data", rank: 3 },
    { name: "æŠ¥ä»·è¿½è¸ªè¡¨", url: "http://bi.sinosafe.com.cn/decision/link/TQlh", category: "biz_data", rank: 4 },
    { name: "å¤šç»´è½¦é™©æˆæœ¬", url: "https://bi.sinosafe.com.cn/decision#/analysis/own/subject/ea63ccdc862c49f1913cdc9015c6b439/report/7a387f2817e84788bdd004cd6bafc36d", category: "biz_data", rank: 5 },
    { name: "é©¾æ„é™©è½¬åŒ–ç‡", url: "http://bi.sinosafe.com.cn/decision/link/jgXN", category: "biz_data", rank: 6 },
    { name: "è´§è½¦é£é™©è¯„åˆ†", url: "https://risk.deltaentropy.com/#/ds", category: "biz_data", rank: 7 },
    { name: "è½¬ç»­ä¿æŠ¥ä»·", url: "http://bi.sinosafe.com.cn/decision/link/Xl80", category: "biz_data", rank: 8 },
    { name: "èµ”ä»˜ç‡åˆ†æ", url: "https://bi.sinosafe.com.cn/decision#/analysis/own/subject/16b7474a1e12452d9ea4736d8db40c9f/report/3435b9d091f14b768de286da4030b614", category: "biz_data", rank: 9 },
    { name: "æ‰¿ä¿æ¸…å•è§„èŒƒ", url: "https://gemini.google.com/share/c88b3a1f1d2c", category: "biz_data", rank: 10, tags: ["doc"] },
    { name: "FineChatBI æŒ‡å¼•", url: "https://help.fanruan.com/finebi/doc-view-2580.html", category: "biz_data", rank: 11, tags: ["doc"] },
    { name: "åº”ç”¨å¤ç”¨åŠ©æ‰‹", url: "https://robot.fanruan.com/chat/app", category: "biz_data", rank: 12 },

    // --- 1.3 å¤–éƒ¨æƒ…æŠ¥ (biz_ext) ---
    { name: "å››å·é‡‘èç›‘ç®¡å±€", url: "https://dfjrjgj.sc.gov.cn/scdfjrjgj/jgdt/2024/2/6/377dc9e8905942acbe10da1b5143a10e.shtml", category: "biz_ext", rank: 1 },
    { name: "å—å……æ”¿åºœæ•°æ®", url: "https://www.nanchong.gov.cn/data/catalog/details.html?id=156619", category: "biz_ext", rank: 2 },
    { name: "ç½‘ç«™å…¬å®‰å¤‡æ¡ˆ", url: "https://beian.mps.gov.cn/web/business/businessHome/draft", category: "biz_ext", rank: 3 },
    { name: "æ±½è½¦ä¹‹å®¶-æ–°èƒ½æº", url: "https://ev.autohome.com.cn/", category: "biz_ext", rank: 4 },
    { name: "ç“œå­äºŒæ‰‹è½¦", url: "https://gz.guazi.com/", category: "biz_ext", rank: 5 },
    { name: "å¡è½¦ä¹‹å®¶", url: "https://product.360che.com/", category: "biz_ext", rank: 6 },
    { name: "æ‘©æ‰˜è½¦ä¹‹å®¶", url: "https://www.newmotor.com.cn/", category: "biz_ext", rank: 7 },

    // --- 2.1 å‰æ²¿æ¨¡å‹ (ai_chat) ---
    { name: "DeepSeek å®˜ç½‘", url: "https://chat.deepseek.com/", category: "ai_chat", rank: 1 },
    { name: "ChatGPT", url: "https://chatgpt.com/?oai-dm=1", category: "ai_chat", rank: 2 },
    { name: "Claude AI", url: "https://claude.ai/", category: "ai_chat", rank: 3 },
    { name: "Gemini", url: "https://gemini.google.com/app", category: "ai_chat", rank: 4 },
    { name: "Grok", url: "https://grok.com/", category: "ai_chat", rank: 5 },
    { name: "LMArena ç«æŠ€åœº", url: "https://lmarena.ai/", category: "ai_chat", rank: 6 },
    { name: "Qwen", url: "https://chat.qwen.ai/", category: "ai_chat", rank: 7 },
    { name: "Jules", url: "https://jules.google.com/task", category: "ai_chat", rank: 8 },
    { name: "Aiswers (å¤šAI)", url: "https://www.aiswers.com/bot/chatgpt", category: "ai_chat", rank: 9 },
    { name: "Google AI Labs", url: "https://labs.google/", category: "ai_chat", rank: 10 },

    // --- 2.2 å›½äº§å¤§æ¨¡ (ai_cn) ---
    { name: "Kimi æ™ºèƒ½åŠ©æ‰‹", url: "https://kimi.moonshot.cn/", category: "ai_cn", rank: 1 },
    { name: "æ™ºè°±æ¸…è¨€", url: "https://chatglm.cn/", category: "ai_cn", rank: 2 },
    { name: "è…¾è®¯å…ƒå®", url: "https://yuanbao.tencent.com/", category: "ai_cn", rank: 3 },
    { name: "é€šä¹‰å¬æ‚Ÿ", url: "https://tingwu.aliyun.com/home", category: "ai_cn", rank: 4 },
    { name: "Gemini 3.0 Pro (é£ä¹¦)", url: "https://kcnj7yazgs86.feishu.cn/wiki/NTsQw69bYiPtgzkHyy7cZRurn1O", category: "ai_cn", rank: 5 },
    { name: "æ–‡å¿ƒä¸€è¨€", url: "https://yiyan.baidu.com/promptCenter", category: "ai_cn", rank: 6 },
    { name: "è¶…ç®—-DeepSeek", url: "https://chat.scnet.cn/", category: "ai_cn", rank: 7 },
    { name: "æ™ºæ™®AI", url: "https://chat.z.ai/", category: "ai_cn", rank: 8 },
    { name: "å¤©å·¥ AI", url: "https://skywork.ai/", category: "ai_cn", rank: 9 },

    // --- 2.3 æ™ºèƒ½æœç´¢ & Agent (ai_search) ---
    { name: "Genspark Agents", url: "https://www.genspark.ai/agents", category: "ai_search", rank: 1 },
    { name: "ç§˜å¡” AI æœç´¢", url: "https://metaso.cn/", category: "ai_search", rank: 2 },
    { name: "çº³ç±³ AI æœç´¢", url: "https://www.n.cn/", category: "ai_search", rank: 3 },
    { name: "Coze (æ‰£å­)", url: "https://www.coze.cn/space-preview", category: "ai_search", rank: 4 },
    { name: "Flowith æ€ç»´é“¾", url: "https://flowith.io/", category: "ai_search", rank: 5 },
    { name: "çŸ¥ä¹ç›´ç­”", url: "https://zhida.zhihu.com/", category: "ai_search", rank: 6 },
    { name: "AI Agents åº“", url: "https://waytoagi.feishu.cn/wiki/GFS0wJB78izVBmk3LVgcCn2MnCh", category: "ai_search", rank: 7 },
    { name: "Vinsoo äº‘Agent", url: "https://www.aiyouthlab.com/", category: "ai_search", rank: 8 },
    { name: "MiniMax Agent", url: "https://agent.minimax.io/", category: "ai_search", rank: 9 },
    { name: "PromptPilot", url: "https://promptpilot.volcengine.com/home", category: "ai_search", rank: 10 },
    { name: "SearchPromptly", url: "https://searchpromptly.com/", category: "ai_search", rank: 11 },
    { name: "PromptMuse", url: "https://promptmuse.net/", category: "ai_search", rank: 12 },

    // --- 3.1 äº‘ç«¯ IDE (dev_ide) ---
    { name: "Cursor Agents", url: "https://cursor.com/cn/agents", category: "dev_ide", rank: 1 },
    { name: "Claude Code", url: "https://claude.ai/code", category: "dev_ide", rank: 2 },
    { name: "Replit", url: "https://replit.com/", category: "dev_ide", rank: 3 },
    { name: "Vercel v0", url: "https://v0.dev/", category: "dev_ide", rank: 4 },
    { name: "Bolt.new", url: "https://bolt.new/", category: "dev_ide", rank: 5 },
    { name: "Google IDX", url: "https://idx.google.com/", category: "dev_ide", rank: 6 },
    { name: "Lovable", url: "https://lovable.dev/", category: "dev_ide", rank: 7 },
    { name: "Manus", url: "https://manus.im/app", category: "dev_ide", rank: 8 },
    { name: "Zoer DBç¼–ç¨‹", url: "https://zoer.ai/", category: "dev_ide", rank: 9 },
    { name: "Colaboratory", url: "https://colab.research.google.com/", category: "dev_ide", rank: 10 },
    { name: "Text Editor", url: "https://texteditor.co/", category: "dev_ide", rank: 11 },
    { name: "CopyCoder", url: "https://copycoder.ai/", category: "dev_ide", rank: 12 },
    { name: "App Gen", url: "https://appgen.groqlabs.com/", category: "dev_ide", rank: 13 },
    { name: "Learn Cursor", url: "https://cursor.directory/learn", category: "dev_ide", rank: 14, tags: ["doc"] },
    { name: "Windsurf æ–‡æ¡£", url: "https://docs.codeium.com/windsurf", category: "dev_ide", rank: 15, tags: ["doc"] },

    // --- 3.2 æ¨¡å‹ API (dev_api) ---
    { name: "DeepSeek API", url: "https://platform.deepseek.com/usage", category: "dev_api", rank: 1 },
    { name: "OpenRouter", url: "https://openrouter.ai/chat", category: "dev_api", rank: 2 },
    { name: "Google AI Studio", url: "https://aistudio.google.com/", category: "dev_api", rank: 3 },
    { name: "ç¡…åŸºæµåŠ¨ API", url: "https://cloud.siliconflow.cn/account/ak", category: "dev_api", rank: 4 },
    { name: "é˜¿é‡Œäº‘ç™¾ç‚¼", url: "https://bailian.console.aliyun.com/", category: "dev_api", rank: 5 },
    { name: "æ™ºè°±å¼€æ”¾å¹³å°", url: "https://open.bigmodel.cn/", category: "dev_api", rank: 6 },
    { name: "Exa API", url: "https://dashboard.exa.ai/", category: "dev_api", rank: 7 },
    { name: "OpenRouter Keys", url: "https://openrouter.ai/settings/keys", category: "dev_api", rank: 8 },
    { name: "ç«å±±å¼•æ“ç™»å½•", url: "https://console.volcengine.com/", category: "dev_api", rank: 9 },

    // --- 3.3 äº‘åŸºå»º (dev_infra) ---
    { name: "GitHub", url: "https://github.com/", category: "dev_infra", rank: 1 },
    { name: "Cloudflare", url: "https://dash.cloudflare.com/", category: "dev_infra", rank: 2 },
    { name: "é˜¿é‡Œäº‘æœåŠ¡å™¨", url: "https://myaccount.console.aliyun.com/", category: "dev_infra", rank: 3 },
    { name: "è…¾è®¯äº‘è½»é‡äº‘", url: "https://console.cloud.tencent.com/lighthouse/", category: "dev_infra", rank: 4 },
    { name: "Supabase", url: "https://supabase.com/", category: "dev_infra", rank: 5 },
    { name: "Firebase Hosting", url: "https://firebase.google.com/docs/hosting", category: "dev_infra", rank: 6 },
    { name: "Firebase Console", url: "https://console.firebase.google.com/", category: "dev_infra", rank: 7 },
    { name: "MemFire Cloud", url: "https://cloud.memfiredb.com/", category: "dev_infra", rank: 8 },
    { name: "MemFire Editor", url: "https://d40alqog91htqli3t530.baseapi.memfiredb.com/project/default/editor", category: "dev_infra", rank: 9 },
    { name: "MemFire è®¤è¯", url: "https://cloud.memfiredb.com/setting/certification", category: "dev_infra", rank: 10 },
    { name: "ICP å¤‡æ¡ˆ", url: "https://console.cloud.tencent.com/beian", category: "dev_infra", rank: 11 },
    { name: "Webify", url: "https://webify.cloudbase.net/", category: "dev_infra", rank: 12 },
    { name: "Git GUI", url: "https://git-scm.com/downloads/guis", category: "dev_infra", rank: 13 },
    { name: "è…¾è®¯äº‘æ–‡æ¡£", url: "https://cloud.tencent.com/document/product/213/2936", category: "dev_infra", rank: 14, tags: ["doc"] },
    { name: "è…¾è®¯äº‘æ”¯æŒ", url: "https://cloud.tencent.com/online-service", category: "dev_infra", rank: 15 },

    // --- 3.4 MCP ç”Ÿæ€ (dev_mcp) ---
    { name: "MCP Servers (Glama)", url: "https://glama.ai/mcp/servers", category: "dev_mcp", rank: 1 },
    { name: "é­”æ­ç¤¾åŒº MCP", url: "https://modelscope.cn/mcp", category: "dev_mcp", rank: 2 },
    { name: "MCP å®éªŒåœº", url: "https://www.modelscope.cn/mcp/playground", category: "dev_mcp", rank: 3 },
    { name: "MCP.so", url: "https://mcp.so/zh", category: "dev_mcp", rank: 4 },
    { name: "Cursor MCP Docs", url: "https://cursor.directory/mcp", category: "dev_mcp", rank: 5, tags: ["doc"] },
    { name: "Claude MCP Docs", url: "https://docs.anthropic.com/zh-CN/docs/claude-code/mcp", category: "dev_mcp", rank: 6, tags: ["doc"] },
    { name: "VS Code MCP", url: "https://code.visualstudio.com/mcp", category: "dev_mcp", rank: 7 },

    // --- 4.1 è§†è§‰ä¸è§†é¢‘ (create_vision) ---
    { name: "Midjourney", url: "https://discord.com/", category: "create_vision", rank: 1 },
    { name: "å¯çµ AI (Kling)", url: "https://app.klingai.com/", category: "create_vision", rank: 2 },
    { name: "Hailuo AI (æµ·èº)", url: "https://hailuoai.video/", category: "create_vision", rank: 3 },
    { name: "Recraft (SVG)", url: "https://www.recraft.ai/", category: "create_vision", rank: 4 },
    { name: "Flux Playground", url: "https://playground.bfl.ai/", category: "create_vision", rank: 5 },
    { name: "æ˜Ÿæµ Art", url: "https://www.xingliu.art/", category: "create_vision", rank: 6 },
    { name: "Hunyuan 3D", url: "https://3d.hunyuan.tencent.com/", category: "create_vision", rank: 7 },
    { name: "è…¾è®¯æ··å…ƒå›¾", url: "https://hunyuan.tencent.com/", category: "create_vision", rank: 8 },
    { name: "Flow (Google)", url: "https://labs.google/fx/tools/flow", category: "create_vision", rank: 9 },
    { name: "SVG åœ¨çº¿ç¼–è¾‘", url: "https://www.jyshare.com/more/svgeditor/", category: "create_vision", rank: 10 },
    { name: "Tldraw (ç”»ä¸€åˆ‡)", url: "https://computer.tldraw.com/", category: "create_vision", rank: 11 },

    // --- 4.2 äº¤äº’ä¸å±•ç¤º (create_design) ---
    { name: "Napkin.ai", url: "https://app.napkin.ai/", category: "create_design", rank: 1 },
    { name: "Figma", url: "https://www.figma.com/", category: "create_design", rank: 2 },
    { name: "AiPPT", url: "https://www.aippt.cn/", category: "create_design", rank: 3 },
    { name: "G2Plot å›¾è¡¨åº“", url: "https://g2plot.antv.antgroup.com/manual/plots/heatmap", category: "create_design", rank: 4, tags: ["doc"] },
    { name: "ChartCube", url: "https://chartcube.alipay.com/guide", category: "create_design", rank: 5 },
    { name: "ElevenLabs (éŸ³)", url: "https://elevenlabs.io/", category: "create_design", rank: 6 },
    { name: "MiniMax Audio", url: "https://www.minimax.io/audio", category: "create_design", rank: 7 },
    { name: "Google Sttich", url: "https://stitch.withgoogle.com/", category: "create_design", rank: 8 },
    { name: "Whisk (FX)", url: "https://labs.google/fx/tools/whisk", category: "create_design", rank: 9 },
    { name: "Lovart", url: "https://www.lovart.ai/", category: "create_design", rank: 10 },
    { name: "Google PPT", url: "https://docs.google.com/presentation/", category: "create_design", rank: 11 },
    { name: "ä»£ç å˜ç½‘é¡µ", url: "https://www.yourware.so/", category: "create_design", rank: 12 },
    { name: "DeepSite (HF)", url: "https://huggingface.co/spaces/enzostvs/deepsite", category: "create_design", rank: 13 },
    { name: "è‡ªç”±ç”»å¸ƒ", url: "https://wenku.baidu.com/board", category: "create_design", rank: 14 },

    // --- 5.1 å­¦æœ¯ç§‘ç ” (know_research) - ç¬¬ä¸€æ€§åŸç†æºå¤´ ---
    { name: "Google Scholar", url: "https://scholar.google.com/", category: "know_research", rank: 1 },
    { name: "Arxiv Papers", url: "https://arxiv.org/", category: "know_research", rank: 2 },
    { name: "Web of Science", url: "https://clarivate.com/products/web-of-science/", category: "know_research", rank: 3 },
    { name: "Scopus", url: "https://www.scopus.com/", category: "know_research", rank: 4 },
    { name: "IEEE Xplore", url: "https://ieeexplore.ieee.org/", category: "know_research", rank: 5 },
    { name: "ScienceDirect", url: "https://www.sciencedirect.com/", category: "know_research", rank: 6 },
    { name: "PubMed", url: "https://pubmed.ncbi.nlm.nih.gov/", category: "know_research", rank: 7 },
    { name: "AI æœè®ºæ–‡ (iFlow)", url: "https://iflow.cn/", category: "know_research", rank: 8 },
    { name: "åˆ›ä½œè®ºæ–‡ (Storm)", url: "https://storm.genie.stanford.edu/", category: "know_research", rank: 9 },

    // --- 5.2 ç¬¬äºŒå¤§è„‘ (know_mgmt) - å†…åŒ– ---
    { name: "Notion", url: "https://www.notion.so/", category: "know_mgmt", rank: 1 },
    { name: "NotebookLM", url: "https://notebooklm.google.com/", category: "know_mgmt", rank: 2 },
    { name: "é£ä¹¦äº‘æ–‡æ¡£", url: "https://fxu5r7nfzg.feishu.cn/", category: "know_mgmt", rank: 3, tags: ["doc"] },
    { name: "å¾—åˆ°AIç¬”è®°", url: "https://www.biji.com/note", category: "know_mgmt", rank: 4 },

    // --- 5.3 ç»ˆèº«å­¦ä¹  (know_learn) - æŠ€èƒ½ ---
    { name: "å¾—åˆ° APP", url: "https://www.dedao.cn/", category: "know_learn", rank: 1 },
    { name: "å¾®ä¿¡è¯»ä¹¦", url: "https://weread.qq.com/", category: "know_learn", rank: 2 },
    { name: "æ··æ²Œå¤§å­¦", url: "https://b.hundun.cn/", category: "know_learn", rank: 3 },
    { name: "Bilibili", url: "https://www.bilibili.com/", category: "know_learn", rank: 4 },
    { name: "YouTube", url: "https://www.youtube.com/", category: "know_learn", rank: 5 },
    { name: "Google Books", url: "https://books.google.com.hk/?hl=zh-CN", category: "know_learn", rank: 6 },
    { name: "å°é¹…é€š", url: "https://xueyuan.xiaoe-tech.com/", category: "know_learn", rank: 7 },
    { name: "é’å°‘å¹´AIç´ å…»", url: "https://e.aice.org.cn/", category: "know_learn", rank: 8 },
    { name: "é£å˜ç¼–ç¨‹", url: "https://www.pypypy.cn/", category: "know_learn", rank: 9 },

    // --- 5.4 å‚è€ƒèµ„æ–™ (know_ref) ---
    { name: "ç°ä»£æ±‰è¯­è¯å…¸", url: "https://cidian.gushici.net/", category: "know_ref", rank: 1 },
    { name: "å­—ä½“å¤©ä¸‹", url: "https://www.fonts.net.cn/", category: "know_ref", rank: 2 },

    // --- 6.1 ååŒé€šè®¯ (tool_collab) ---
    { name: "Gmail", url: "https://mail.google.com/", category: "tool_collab", rank: 1 },
    { name: "Outlook", url: "https://outlook.live.com/", category: "tool_collab", rank: 2 },
    { name: "Slack", url: "https://app.slack.com/", category: "tool_collab", rank: 3 },
    { name: "å…¬ä¼—å·æ–‡ç« ", url: "https://mp.weixin.qq.com/cgi-bin/home", category: "tool_collab", rank: 4 },

    // --- 6.2 åŠå…¬ä¸æ•°æ® (tool_office) ---
    { name: "ProcessOn", url: "https://www.processon.com/", category: "tool_office", rank: 1 },
    { name: "é‡‘å±±æ–‡æ¡£", url: "https://www.kdocs.cn/", category: "tool_office", rank: 2 },
    { name: "TableConvert", url: "https://tableconvert.com/", category: "tool_office", rank: 3 },
    { name: "n8n è‡ªåŠ¨åŒ–", url: "https://app.n8n.cloud/", category: "tool_office", rank: 4 },
    { name: "WPS è„šæœ¬æŒ‡å—", url: "https://365.kdocs.cn/l/cuUFLE0Ufojw", category: "tool_office", rank: 5, tags: ["doc"] },
    { name: "åœ¨çº¿ PDF è½¬æ¢", url: "https://pdf2000.com/", category: "tool_office", rank: 6 },
    { name: "é—ªå‡» PPT", url: "https://ppt.sankki.com/", category: "tool_office", rank: 7 },
    { name: "å…è´¹æŠ å›¾", url: "https://pixian.ai/", category: "tool_office", rank: 8 },
    { name: "é—®å·ç½‘", url: "https://www.wenjuan.com/", category: "tool_office", rank: 9 },
    { name: "Tushare æ•°æ®", url: "https://tushare.pro/", category: "tool_office", rank: 10 },
    { name: "Cretvalu", url: "https://cretvalu.com/", category: "tool_office", rank: 11 },
    { name: "Context.ai", url: "https://www.context.ai/", category: "tool_office", rank: 12 },
    { name: "AIToolX", url: "https://aitoolx.cn/", category: "tool_office", rank: 13 },

    // --- 6.3 ç½‘ç»œä¸è´¦æˆ· (tool_net) ---
    { name: "Google One", url: "https://one.google.com/", category: "tool_net", rank: 1 },
    { name: "JustMySocks", url: "https://justmysocks.net/", category: "tool_net", rank: 2, tags: ["vpn"] },
    { name: "IP æ³„éœ²æ£€æµ‹", url: "https://ipleak.net/", category: "tool_net", rank: 3 },
    { name: "Gemini CLI", url: "https://geminicli.com/extensions/", category: "tool_net", rank: 4 },
    { name: "reCAPTCHA", url: "https://www.google.com/recaptcha/admin", category: "tool_net", rank: 5 },
    { name: "è…¾è®¯åœ¨çº¿å·¥å…·", url: "https://tool.browser.qq.com/", category: "tool_net", rank: 6 },
    { name: "é˜³å…‰å¼€å¥–", url: "https://www.cwl.gov.cn/", category: "tool_net", rank: 7 },

    // --- 6.4 ä¸ªäººå‘å¸ƒ (my_works) ---
    { name: "Markdown è½¬ Excel", url: "https://alongor666.github.io/Table_Forge/", category: "my_works", rank: 1 },
    { name: "è½¦é™©ç»è¥åˆ†æå‘¨æŠ¥", url: "https://autinsight.web.app/", category: "my_works", rank: 2 },
    { name: "æ‘©æ‰˜è½¦æˆæœ¬æ¨¡å‹", url: "https://alongor666.github.io/moto_cost/", category: "my_works", rank: 3 },
    { name: "å¯ç»­æœŸæŸ¥è¯¢", url: "https://alongor666.github.io/Fee-re/", category: "my_works", rank: 4 },
    { name: "æ’æ··è½¦å‹å¯è§†åŒ–", url: "http://127.0.0.1:5501/%E8%BD%A6%E5%9E%8B.html", category: "my_works", rank: 5 },
    { name: "GenAI é—ªå¡", url: "https://019a84ee-d564-7826-8aef-953b787e589f.arena.site/", category: "my_works", rank: 6 },
    { name: "Gemini Proxy", url: "https://gemini-proxy.alongor0512.workers.dev/", category: "my_works", rank: 7 },
    { name: "ACL4SSR è®¢é˜…", url: "https://acl4ssr-sub.github.io/", category: "my_works", rank: 8 },
    { name: "Google ç½‘ç«™", url: "https://sites.google.com/", category: "my_works", rank: 9 }
];

createApp({
    setup() {
        // åŠ å¯†å­˜å‚¨å·¥å…·
        const secureStorage = {
            // ç”Ÿæˆå›ºå®šå¯†é’¥ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä»ç”¨æˆ·è¾“å…¥æˆ–å®‰å…¨ä¸Šä¸‹æ–‡è·å–ï¼‰
            getSecretKey: () => {
                let key = localStorage.getItem('storage_key');
                if (!key) {
                    key = CryptoJS.lib.WordArray.random(256/8).toString();
                    localStorage.setItem('storage_key', key);
                }
                return key;
            },

            // åŠ å¯†æ•°æ®
            encrypt: (data) => {
                try {
                    const encrypted = CryptoJS.AES.encrypt(data, secureStorage.getSecretKey()).toString();
                    return encrypted;
                } catch (e) {
                    console.error('Encryption failed:', e);
                    return null;
                }
            },

            // è§£å¯†æ•°æ®
            decrypt: (encryptedData) => {
                try {
                    const decrypted = CryptoJS.AES.decrypt(encryptedData, secureStorage.getSecretKey());
                    return decrypted.toString(CryptoJS.enc.Utf8);
                } catch (e) {
                    console.error('Decryption failed:', e);
                    return null;
                }
            },

            // å®‰å…¨å­˜å‚¨
            setItem: (key, value) => {
                const encrypted = secureStorage.encrypt(value);
                if (encrypted) {
                    localStorage.setItem(`secure_${key}`, encrypted);
                }
            },

            // å®‰å…¨è¯»å–
            getItem: (key) => {
                const encrypted = localStorage.getItem(`secure_${key}`);
                if (encrypted) {
                    return secureStorage.decrypt(encrypted);
                }
                return null;
            },

            // åˆ é™¤
            removeItem: (key) => {
                localStorage.removeItem(`secure_${key}`);
            }
        };

        const allSites = ref([]);
        const searchQuery = ref("");
        const currentFilter = ref("all");
        const showModal = ref(false);
        const currentTime = ref("");
        const showSettingsModal = ref(false);
        const showAnalysisModal = ref(false);
        const tempApiKey = ref(secureStorage.getItem('gemini_api_key') || '');
        const apiKey = ref(secureStorage.getItem('gemini_api_key') || '');
        const smartInput = ref("");
        const isProcessing = ref(false);
        const isAnalyzing = ref(false);
        const analysisResult = ref("");
        const newSite = ref({ name: "", url: "", category: "tool_office", rank: 99 });

        const flatCategories = computed(() => CATEGORY_STRUCTURE.flatMap(g => g.items));
        const groupedCategories = computed(() => CATEGORY_STRUCTURE);

        onMounted(() => {
            loadSites();
            updateTime();
            setInterval(updateTime, 1000);
        });

        const loadSites = () => {
            const stored = localStorage.getItem('ahlong_assets_v5_3');
            if (stored) {
                const localSites = JSON.parse(stored);
                const siteMap = new Map();
                localSites.forEach(s => siteMap.set(s.url, s));
                PARSED_DATA.forEach(s => {
                    const existing = siteMap.get(s.url) || {};
                    siteMap.set(s.url, { ...existing, ...s });
                });
                allSites.value = Array.from(siteMap.values());
            } else {
                allSites.value = PARSED_DATA;
                saveSites();
            }
        };

        const saveSites = () => localStorage.setItem('ahlong_assets_v5_3', JSON.stringify(allSites.value));
        const updateTime = () => currentTime.value = new Date().toLocaleTimeString('zh-CN', {hour:'2-digit', minute:'2-digit'});
        const getCountByCategory = (catId) => allSites.value.filter(s => s.category === catId).length;
        const getCategoryColor = (catId) => flatCategories.value.find(c => c.id === catId)?.color || '#ccc';

        const displaySites = computed(() => {
            let result = allSites.value;
            const q = searchQuery.value.toLowerCase();
            if (q) {
                result = result.filter(s => s.name.toLowerCase().includes(q) || s.url.toLowerCase().includes(q));
            } else if (currentFilter.value !== 'all') {
                result = result.filter(s => s.category === currentFilter.value);
            }
            return result.sort((a, b) => {
                const rankA = a.rank || 99;
                const rankB = b.rank || 99;
                if (rankA !== rankB) return rankA - rankB;
                return a.name.localeCompare(b.name, 'zh-CN');
            });
        });

        const displaySitesGrouped = computed(() => {
            if (currentFilter.value !== 'all' || searchQuery.value) return {};
            const groups = {};
            CATEGORY_STRUCTURE.forEach(group => {
                group.items.forEach(cat => {
                    const items = allSites.value.filter(s => s.category === cat.id);
                    if (items.length > 0) {
                        items.sort((a, b) => (a.rank || 99) - (b.rank || 99));
                        groups[cat.name] = items;
                    }
                });
            });
            return groups;
        });

        const getFavicon = (url) => {
            try { return `https://www.google.com/s2/favicons?domain=${new URL(url).hostname}&sz=64`; } 
            catch { return 'https://via.placeholder.com/64?text=WEB'; }
        };
        const handleImageError = (e) => e.target.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23cbd5e1'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z'/%3E%3C/svg%3E";
        const getDomain = (url) => { try { return new URL(url).hostname.replace('www.', ''); } catch { return url; } };
        const getCurrentPageTitle = computed(() => {
            if (currentFilter.value === 'all') return 'å…¨å±€èµ„äº§å…¨æ™¯';
            return flatCategories.value.find(c => c.id === currentFilter.value)?.name || 'Asset';
        });

        const visitSite = (s) => window.open(s.url, '_blank');
        const deleteSite = (s) => { if(confirm(`åˆ é™¤ ${s.name}?`)) { allSites.value = allSites.value.filter(i => i !== s); saveSites(); }};
        
        const openAddModal = () => { showModal.value = true; };
        const closeModal = () => showModal.value = false;
        const addSite = () => {
            if(!newSite.value.name) return;
            allSites.value.push({...newSite.value, rank: 99}); 
            saveSites(); closeModal();
        };
        const openSettings = () => { tempApiKey.value = apiKey.value; showSettingsModal.value = true; };
        const saveSettings = () => {
          apiKey.value = tempApiKey.value;
          secureStorage.setItem('gemini_api_key', apiKey.value);
          showSettingsModal.value = false;
      };
        
        const callGemini = async (prompt) => {
            if (!apiKey.value) { alert("è¯·å…ˆé…ç½® API Key"); openSettings(); throw new Error("No Key"); }
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey.value}`;
            const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
            if (!res.ok) throw new Error("API Error");
            return (await res.json()).candidates[0].content.parts[0].text;
        };

        const smartParse = async () => {
            if (!smartInput.value) return;
            isProcessing.value = true;
            try {
                const cats = JSON.stringify(flatCategories.value.map(c => ({id: c.id, name: c.name})));
                const prompt = `Extract name and url from text: "${smartInput.value}". Map to category in ${cats}. Return JSON: {"name": "", "url": "", "category": ""}`;
                const text = await callGemini(prompt);
                const json = JSON.parse(text.replace(/```json|```/g, '').trim());
                newSite.value = { ...json, rank: 99 };
            } catch (e) { console.error(e); alert("è¯†åˆ«å¤±è´¥"); } finally { isProcessing.value = false; }
        };

        const openAnalysisModal = () => showAnalysisModal.value = true;
        const closeAnalysisModal = () => showAnalysisModal.value = false;
        const analyzeAssets = async () => {
            isAnalyzing.value = true;
            try {
                const list = allSites.value.map(s => `${s.name}(${s.category})`).join(", ");
                const res = await callGemini(`åˆ†ææˆ‘çš„èµ„äº§åˆ—è¡¨ï¼š[${list}]ã€‚1. è§’è‰²ç”»åƒã€‚2. MECEç¼ºå¤±åˆ†æã€‚3. 3ä¸ªæ¨èå·¥å…·ã€‚Markdownè¾“å‡ºã€‚`);
                analysisResult.value = res;
            } catch (e) { analysisResult.value = "åˆ†æå¤±è´¥"; } finally { isAnalyzing.value = false; }
        };
        const renderMarkdown = (t) => marked.parse(t);
        const safeRenderMarkdown = (t) => DOMPurify.sanitize(marked.parse(t));

        return {
            allSites, groupedCategories, flatCategories, currentFilter, displaySites, displaySitesGrouped,
            searchQuery, currentTime, showModal, showSettingsModal, showAnalysisModal,
            tempApiKey, smartInput, isProcessing, isAnalyzing, analysisResult, newSite, getCurrentPageTitle,
            openAddModal, closeModal, addSite, openSettings, saveSettings, openAnalysisModal, closeAnalysisModal,
            smartParse, analyzeAssets, renderMarkdown, safeRenderMarkdown, getFavicon, handleImageError, getDomain,
            visitSite, deleteSite, getCountByCategory, getCategoryColor
        };
    }
}).mount('#app');
</script>
</body>
</html>